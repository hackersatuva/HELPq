{"version":3,"sources":["meteor://ðŸ’»app/server/publications.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C","file":"/server/publications.js","sourcesContent":["// ---------------------------------------\n// Publish Data\n// ---------------------------------------\n\nMeteor.publish(\"userData\", getUserData);\nMeteor.publish(\"allUsers\", getAllUsers);\nMeteor.publish(\"allMentors\", getAllMentors);\nMeteor.publish(\"mentorsOnline\", getMentorsOnline);\n\nMeteor.publish(\"activeTickets\", getActiveTickets);\nMeteor.publish(\"allTickets\", getAllTickets);\nMeteor.publish(\"ticketData\", getTicketData);\nMeteor.publish(\"userTickets\", getUserTickets);\n\nMeteor.publish(\"allAnnouncements\", getAllAnnouncements);\n\nMeteor.publish(\"settings\", getSettings);\n\n// Get user data on yourself\nfunction getUserData(){\n  if (authorized.user(this.userId)) {\n    return Meteor.users.find({_id: this.userId},\n        {\n          fields: {\n            'services': 1,\n            'profile': 1\n          }\n        });\n  } else {\n    this.ready();\n  }\n}\n\n// Get all users\nfunction getAllUsers(){\n  if (authorized.admin(this.userId)) {\n    return Meteor.users.find({},\n        {\n          fields: {\n            'createdAt': 1,\n            'username': 1,\n            'services': 1,\n            'profile': 1\n          }\n        });\n  }\n}\n\n// Mentors are able to see each other.\nfunction getAllMentors(){\n  if (authorized.mentor(this.userId)){\n    return Meteor.users.find({\n      'profile.mentor': true\n    },{\n      fields: {\n        'profile.name': 1,\n        'profile.mentor': 1,\n        'profile.company': 1,\n        'profile.skills': 1,\n        'services.facebook.id': 1\n      }\n    });\n  }\n}\n\n// All users can see any mentor that is currently online\nfunction getMentorsOnline(){\n  if (authorized.user(this.userId)) {\n    return Meteor.users.find({\n      'profile.mentor': true,\n      'status.online': true\n    }, {\n      fields: {\n        'profile.name': 1,\n        'profile.email': 1,\n        'profile.phone': 1,\n        'profile.admin': 1,\n        'profile.mentor': 1,\n        'profile.skills': 1,\n        'status.idle': 1,\n        'status.online': 1\n      }\n    });\n  }\n}\n\n// Get all of the active tickets\nfunction getActiveTickets(){\n  if (authorized.user(this.userId)) {\n    return Tickets.find(\n        {\n          status: {\n            $in: [\"OPEN\", \"CLAIMED\"]\n          }\n        }, {\n          sort: {\n            timestamp: 1\n          }\n        });\n  } else {\n    this.ready();\n  }\n}\n\nfunction getTicketData(){\n  if (authorized.user(this.userId)){\n    return Tickets.find({},\n        {\n          fields: {\n            timestamp: 1,\n            claimId: 1,\n            claimTime: 1,\n            completeTime: 1,\n            status: 1,\n            rating: 1\n          }\n        });\n  }\n}\n\n// Get all of the tickets\nfunction getAllTickets(){\n  if (authorized.admin(this.userId)){\n    return Tickets.find({});\n  } else {\n    // If not admin, have limited fields\n    if (authorized.user(this.userId)){\n      return Tickets.find({},\n          {\n            fields: {\n              timestamp: 1,\n              claimId: 1,\n              claimTime: 1,\n              completeTime: 1,\n              status: 1,\n              rating: 1\n            }\n          });\n    }\n  }\n}\n\n// Get the tickets for the current user\nfunction getUserTickets(){\n  if (authorized.user(this.userId)){\n    return Tickets.find({\n      userId: this.userId\n    });\n  }\n}\n\n// Get all of the announcements\nfunction getAllAnnouncements(){\n  if (authorized.user(this.userId)){\n    return Announcements.find({});\n  }\n}\n\nfunction getSettings(){\n  if (authorized.user(this.userId)){\n    return Settings.find({});\n  }\n}"]}